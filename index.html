function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const email = username + "@yourdomain.com"; // Match registration format

  firebase.auth().signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Check if user is approved (in Firestore)
      const db = firebase.firestore();
      db.collection("approvedUsers").doc(userCredential.user.uid).get()
        .then((doc) => {
          if (doc.exists) {
            // User is approved
            localStorage.setItem('loggedInUser', username);
            window.location.href = 'mqtt_control.html';
          } else {
            // User not approved
            firebase.auth().signOut();
            alert('Your account is pending approval');
          }
        });
    })
    .catch((error) => {
      alert(error.message);
    });
}
